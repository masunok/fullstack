{% extends "base.html" %}

{% block title %}ê²Œì‹œíŒ ê´€ë¦¬ - AIZEVA ê´€ë¦¬ì{% endblock %}

{% block content %}
<main class="container mx-auto px-4 py-8">
  <!-- Admin Header -->
  <div class="admin-header mb-8">
    <div class="flex flex-col md:flex-row md:items-center md:justify-between">
      <div>
        <h1 class="text-3xl font-bold text-gray-800 mb-2">ê²Œì‹œíŒ ê´€ë¦¬</h1>
        <p class="text-gray-600">AIZEVA ê²Œì‹œíŒë“¤ì„ ê´€ë¦¬í•©ë‹ˆë‹¤</p>
      </div>

      <!-- Admin Navigation -->
      <div class="admin-nav mt-4 md:mt-0">
        <nav class="flex space-x-4">
          <a
            href="/admin/users/page"
            class="px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 text-sm transition-colors"
          >
            ì‚¬ìš©ì ê´€ë¦¬
          </a>
          <a
            href="/admin/boards/page"
            class="px-4 py-2 bg-blue-600 text-white rounded-md text-sm transition-colors"
          >
            ê²Œì‹œíŒ ê´€ë¦¬
          </a>
        </nav>
      </div>
    </div>
  </div>

  <!-- Actions Bar -->
  <div id="stats-section" class="actions-bar bg-white p-6 rounded-lg shadow border mb-6">
    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
      <!-- Search -->
      <div class="search-box flex-1">
        <form method="GET" action="/admin/boards/page" class="flex">
          <input
            type="text"
            name="q"
            value="{{ request.query_params.get('q', '') }}"
            placeholder="ê²Œì‹œíŒ ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰..."
            class="flex-1 border border-gray-300 rounded-l-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
          />
          <button
            type="submit"
            class="bg-blue-600 text-white px-4 py-2 rounded-r-md hover:bg-blue-700 text-sm transition-colors"
          >
            ê²€ìƒ‰
          </button>
        </form>
      </div>

      <!-- Create Board -->
      <div class="create-action">
        <button
          onclick="showCreateBoardModal()"
          class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 text-sm transition-colors"
        >
          ìƒˆ ê²Œì‹œíŒ ë§Œë“¤ê¸°
        </button>
      </div>
    </div>
  </div>

  <!-- Boards Grid -->
  <div class="boards-grid grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    {% for board in boards %}
    <div class="board-card bg-white p-6 rounded-lg shadow border hover:shadow-md transition-shadow">
      <!-- Board Header -->
      <div class="board-header mb-4">
        <div class="flex items-start justify-between mb-2">
          <h3 class="text-lg font-semibold text-gray-800">{{ board.name }}</h3>
          <div class="board-actions flex space-x-1">
            <button
              onclick="editBoard({{ board.id }})"
              class="p-1 text-gray-500 hover:text-blue-600 transition-colors"
              title="í¸ì§‘"
            >
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
              </svg>
            </button>
            <button
              onclick="confirmDeleteBoard({{ board.id }}, '{{ board.name }}')"
              class="p-1 text-gray-500 hover:text-red-600 transition-colors"
              title="ì‚­ì œ"
            >
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
              </svg>
            </button>
          </div>
        </div>
        <p class="text-gray-600 text-sm mb-3">{{ board.description }}</p>
        <div class="board-slug text-xs text-gray-500 font-mono bg-gray-100 px-2 py-1 rounded">
          /boards/{{ board.slug }}
        </div>
      </div>

      <!-- Board Stats -->
      <div class="board-stats mb-4">
        <div class="grid grid-cols-2 gap-4 text-center">
          <div class="stat">
            <div class="text-lg font-bold text-blue-600">{{ board.post_count or 0 }}</div>
            <div class="text-xs text-gray-600">ê²Œì‹œê¸€</div>
          </div>
          <div class="stat">
            <div class="text-lg font-bold text-green-600">{{ board.comment_count or 0 }}</div>
            <div class="text-xs text-gray-600">ëŒ“ê¸€</div>
          </div>
        </div>
      </div>

      <!-- Board Settings -->
      <div class="board-settings mb-4">
        <div class="setting-item flex justify-between items-center mb-2">
          <span class="text-sm text-gray-600">ì‘ì„± ê¶Œí•œ</span>
          <span class="inline-block px-2 py-1 text-xs rounded-full {% if board.write_permission == 'all' %}bg-green-100 text-green-600{% elif board.write_permission == 'member' %}bg-blue-100 text-blue-600{% else %}bg-gray-100 text-gray-600{% endif %}">
            {% if board.write_permission == 'all' %}
              ì „ì²´ ê³µê°œ
            {% elif board.write_permission == 'member' %}
              íšŒì›ë§Œ
            {% else %}
              ê´€ë¦¬ìë§Œ
            {% endif %}
          </span>
        </div>
        <div class="setting-item flex justify-between items-center">
          <span class="text-sm text-gray-600">ìƒì„±ì¼</span>
          <span class="text-sm text-gray-500">{{ board.created_at[:10] if board.created_at else '' }}</span>
        </div>
      </div>

      <!-- Latest Activity -->
      {% if board.latest_post %}
      <div class="latest-activity border-t pt-4">
        <div class="text-xs text-gray-500 mb-1">ìµœê·¼ ê²Œì‹œê¸€</div>
        <div class="latest-post">
          <a
            href="/posts/{{ board.latest_post.id }}"
            class="text-sm text-gray-700 hover:text-blue-600 line-clamp-1 transition-colors"
          >
            {{ board.latest_post.title }}
          </a>
          <div class="text-xs text-gray-500 mt-1">
            by {{ board.latest_post.author_name }} Â· {{ board.latest_post.created_at[:16] if board.latest_post.created_at else '' }}
          </div>
        </div>
      </div>
      {% endif %}

      <!-- Quick Actions -->
      <div class="quick-actions mt-4 pt-4 border-t">
        <div class="flex space-x-2">
          <a
            href="/boards/{{ board.slug }}"
            class="flex-1 text-center px-3 py-2 bg-blue-600 text-white rounded text-sm hover:bg-blue-700 transition-colors"
          >
            ê²Œì‹œíŒ ë³´ê¸°
          </a>
          <button
            onclick="editBoard({{ board.id }})"
            class="flex-1 text-center px-3 py-2 border border-gray-300 text-gray-700 rounded text-sm hover:bg-gray-50 transition-colors"
          >
            í¸ì§‘
          </button>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>

  <!-- Empty State -->
  {% if not boards %}
  <div class="empty-state text-center py-12">
    {% if request.query_params.get('q') %}
    <div class="text-gray-400 text-6xl mb-4">ğŸ”</div>
    <h3 class="text-lg font-medium text-gray-700 mb-2">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
    <p class="text-gray-500 mb-4">ë‹¤ë¥¸ ê²€ìƒ‰ì–´ë¡œ ì‹œë„í•´ë³´ì„¸ìš”</p>
    <a
      href="/admin/boards/page"
      class="inline-block px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors"
    >
      ì „ì²´ ê²Œì‹œíŒ ë³´ê¸°
    </a>
    {% else %}
    <div class="text-gray-400 text-6xl mb-4">ğŸ“‹</div>
    <h3 class="text-lg font-medium text-gray-700 mb-2">ì•„ì§ ê²Œì‹œíŒì´ ì—†ìŠµë‹ˆë‹¤</h3>
    <p class="text-gray-500 mb-4">ì²« ë²ˆì§¸ ê²Œì‹œíŒì„ ë§Œë“¤ì–´ë³´ì„¸ìš”</p>
    <button
      onclick="showCreateBoardModal()"
      class="inline-block px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors"
    >
      ê²Œì‹œíŒ ë§Œë“¤ê¸°
    </button>
    {% endif %}
  </div>
  {% endif %}
</main>

<!-- Create/Edit Board Modal -->
<div id="board-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
  <div class="flex items-center justify-center min-h-screen p-4">
    <div class="bg-white rounded-lg p-6 max-w-md w-full">
      <h3 class="text-lg font-medium text-gray-900 mb-4" id="board-modal-title">ìƒˆ ê²Œì‹œíŒ ë§Œë“¤ê¸°</h3>

      <form id="board-form" method="POST">
        <input type="hidden" name="csrf_token" value="{{ csrf_token }}"/>
        <input type="hidden" id="board-id" name="board_id" value=""/>

        <!-- Board Name -->
        <div class="form-group mb-4">
          <label for="board-name" class="block text-sm font-medium text-gray-700 mb-2">
            ê²Œì‹œíŒ ì´ë¦„ <span class="text-red-500">*</span>
          </label>
          <input
            type="text"
            id="board-name"
            name="name"
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
            placeholder="ê²Œì‹œíŒ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”"
            required
            maxlength="100"
          />
        </div>

        <!-- Board Slug -->
        <div class="form-group mb-4">
          <label for="board-slug" class="block text-sm font-medium text-gray-700 mb-2">
            URL ìŠ¬ëŸ¬ê·¸ <span class="text-red-500">*</span>
          </label>
          <input
            type="text"
            id="board-slug"
            name="slug"
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
            placeholder="ì˜ë¬¸ì, ìˆ«ì, í•˜ì´í”ˆë§Œ ì‚¬ìš©"
            required
            maxlength="50"
            pattern="^[a-z0-9-]+$"
          />
          <div class="text-xs text-gray-500 mt-1">URL: /boards/<span id="slug-preview"></span></div>
        </div>

        <!-- Board Description -->
        <div class="form-group mb-4">
          <label for="board-description" class="block text-sm font-medium text-gray-700 mb-2">
            ì„¤ëª…
          </label>
          <textarea
            id="board-description"
            name="description"
            rows="3"
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
            placeholder="ê²Œì‹œíŒì— ëŒ€í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"
            maxlength="500"
          ></textarea>
        </div>

        <!-- Write Permission -->
        <div class="form-group mb-6">
          <label for="write-permission" class="block text-sm font-medium text-gray-700 mb-2">
            ì‘ì„± ê¶Œí•œ <span class="text-red-500">*</span>
          </label>
          <select
            id="write-permission"
            name="write_permission"
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
            required
          >
            <option value="all">ì „ì²´ ê³µê°œ (ë¹„íšŒì›ë„ ê°€ëŠ¥)</option>
            <option value="member" selected>íšŒì›ë§Œ ì‘ì„± ê°€ëŠ¥</option>
            <option value="admin">ê´€ë¦¬ìë§Œ ì‘ì„± ê°€ëŠ¥</option>
          </select>
        </div>

        <!-- Form Actions -->
        <div class="flex justify-end space-x-3">
          <button
            type="button"
            onclick="closeBoardModal()"
            class="px-4 py-2 text-gray-600 border border-gray-300 rounded hover:bg-gray-100 transition-colors"
          >
            ì·¨ì†Œ
          </button>
          <button
            type="submit"
            class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors"
          >
            ì €ì¥
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div id="delete-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
  <div class="flex items-center justify-center min-h-screen p-4">
    <div class="bg-white rounded-lg p-6 max-w-md w-full">
      <h3 class="text-lg font-medium text-gray-900 mb-4">ê²Œì‹œíŒ ì‚­ì œ</h3>
      <p class="text-gray-600 mb-6" id="delete-message">
        ì •ë§ë¡œ ì´ ê²Œì‹œíŒì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ê²Œì‹œíŒ ë‚´ì˜ ëª¨ë“  ê²Œì‹œê¸€ê³¼ ëŒ“ê¸€ì´ í•¨ê»˜ ì‚­ì œë©ë‹ˆë‹¤. ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
      </p>
      <div class="flex justify-end space-x-3">
        <button
          onclick="closeDeleteModal()"
          class="px-4 py-2 text-gray-600 border border-gray-300 rounded hover:bg-gray-100 transition-colors"
        >
          ì·¨ì†Œ
        </button>
        <button
          id="confirm-delete-btn"
          class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors"
        >
          ì‚­ì œ
        </button>
      </div>
    </div>
  </div>
</div>

<script>
// Board creation/editing
function showCreateBoardModal() {
  document.getElementById('board-modal-title').textContent = 'ìƒˆ ê²Œì‹œíŒ ë§Œë“¤ê¸°';
  document.getElementById('board-form').action = '/admin/boards';
  document.getElementById('board-id').value = '';
  document.getElementById('board-name').value = '';
  document.getElementById('board-slug').value = '';
  document.getElementById('board-description').value = '';
  document.getElementById('write-permission').value = 'member';
  document.getElementById('board-modal').classList.remove('hidden');
  document.getElementById('board-name').focus();
}

function editBoard(boardId) {
  // In a real implementation, you would fetch board data via AJAX
  // For now, we'll use a placeholder
  document.getElementById('board-modal-title').textContent = 'ê²Œì‹œíŒ í¸ì§‘';
  document.getElementById('board-form').action = `/admin/boards/${boardId}`;
  document.getElementById('board-id').value = boardId;
  document.getElementById('board-modal').classList.remove('hidden');

  // TODO: Fetch and populate board data
  alert('ê²Œì‹œíŒ í¸ì§‘ ê¸°ëŠ¥ì€ ì¶”í›„ êµ¬í˜„ ì˜ˆì •ì…ë‹ˆë‹¤.');
}

function closeBoardModal() {
  document.getElementById('board-modal').classList.add('hidden');
}

// Slug generation
document.addEventListener('DOMContentLoaded', function() {
  const nameInput = document.getElementById('board-name');
  const slugInput = document.getElementById('board-slug');
  const slugPreview = document.getElementById('slug-preview');

  nameInput.addEventListener('input', function() {
    if (!slugInput.value) {
      const slug = this.value
        .toLowerCase()
        .replace(/[^a-z0-9ê°€-í£]/g, '-')
        .replace(/-+/g, '-')
        .replace(/^-|-$/g, '');
      slugInput.value = slug;
      slugPreview.textContent = slug;
    }
  });

  slugInput.addEventListener('input', function() {
    slugPreview.textContent = this.value;
  });

  // Form submission
  document.getElementById('board-form').addEventListener('submit', function(e) {
    const slug = slugInput.value;
    if (!/^[a-z0-9-]+$/.test(slug)) {
      e.preventDefault();
      alert('ìŠ¬ëŸ¬ê·¸ëŠ” ì˜ë¬¸ ì†Œë¬¸ì, ìˆ«ì, í•˜ì´í”ˆë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
      return;
    }
  });
});

// Board deletion
let deleteTargetId = 0;

function confirmDeleteBoard(boardId, boardName) {
  deleteTargetId = boardId;
  document.getElementById('delete-message').innerHTML =
    `ì •ë§ë¡œ "<strong>${boardName}</strong>" ê²Œì‹œíŒì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ê²Œì‹œíŒ ë‚´ì˜ ëª¨ë“  ê²Œì‹œê¸€ê³¼ ëŒ“ê¸€ì´ í•¨ê»˜ ì‚­ì œë©ë‹ˆë‹¤. ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`;
  document.getElementById('delete-modal').classList.remove('hidden');
}

function closeDeleteModal() {
  document.getElementById('delete-modal').classList.add('hidden');
  deleteTargetId = 0;
}

document.getElementById('confirm-delete-btn').addEventListener('click', function() {
  if (deleteTargetId) {
    const form = document.createElement('form');
    form.method = 'POST';
    form.action = `/admin/boards/${deleteTargetId}/delete`;
    form.innerHTML = `
      <input type="hidden" name="csrf_token" value="{{ csrf_token }}"/>
    `;
    document.body.appendChild(form);
    form.submit();
  }
});

// Close modals when clicking outside
document.getElementById('board-modal').addEventListener('click', function(e) {
  if (e.target === this) {
    closeBoardModal();
  }
});

document.getElementById('delete-modal').addEventListener('click', function(e) {
  if (e.target === this) {
    closeDeleteModal();
  }
});

// Keyboard shortcuts
document.addEventListener('keydown', function(e) {
  // Escape to close modals
  if (e.key === 'Escape') {
    closeBoardModal();
    closeDeleteModal();
  }

  // Ctrl+N for new board
  if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
    e.preventDefault();
    showCreateBoardModal();
  }
});
</script>
{% endblock %}